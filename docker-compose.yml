version: '3'
services:
  luya_composer:
    image: composer
    volumes:
      - ./:/app
    command: composer install

  luya_php:
    image: luyadev/luya-docker-php
    expose:
      - 9000
    volumes:
      - ./:/app

  luya_db:
    image: mysql:5.7
    command:
      - --character-set-server=utf8
      - --collation-server=utf8_general_ci
    environment:
      MYSQL_ROOT_PASSWORD: luya
      MYSQL_DATABASE: luya_kickstarter
      MYSQL_USER: luya
      MYSQL_PASSWORD: luya
    expose:
      - 3306
    ports:
      - 3366:3306
    volumes:
      - kickstarter-db:/var/lib/mysql

  luya_web:
    image: luyadev/luya-docker-nginx
    ports:
      - 8080:80
    volumes:
      - ./:/app
#      - ./configs/nginx/conf.d:/etc/nginx/conf.d
    links:
      - luya_db
    depends_on:
      - luya_php
      - luya_db

  luya_adminer:
    image: adminer:4.7.1
    restart: always
    ports:
      - 12080:8080
    links:
      - luya_db

networks:
  kickstarter-luya:
    driver: local

volumes:
  kickstarter-db:
